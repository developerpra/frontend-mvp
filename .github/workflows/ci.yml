name: CI Checks

on:
  pull_request:
    branches:
      - develop
      - release
      - main

jobs:
  ci-checks:
    name: Code Quality, Lint, Type Check, Prettier, Build
    runs-on: ubuntu-latest

    steps:
      # Checkout code
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Setup Node
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "npm"

      # Install dependencies
      - name: Install Dependencies
        run: npm ci

      # 1Ô∏è‚É£ CODE REVIEW AUTOMATION ‚Äî PR Title/Description Validation
      - name: Validate PR Title
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # 2Ô∏è‚É£ ESLINT ‚Äî Code Best Practices
      - name: Run ESLint
        run: npm run lint

      # 3Ô∏è‚É£ PRETTIER ‚Äî Enforce Formatting
      - name: Run Prettier Check
        run: npx prettier --check "src/**/*.{ts,tsx,js,jsx,json,css,md}"

      # 4Ô∏è‚É£ TYPESCRIPT ‚Äî Static Type Checking
      - name: TypeScript Check
        run: npx tsc --noEmit

      # 5Ô∏è‚É£ CHECK FOR CONSOLE LOG (except in development code)
      - name: Check for console logs
        run: |
          if grep -R "console.log" -n src/ --exclude-dir="**/pwa" --exclude="*.test.ts" --exclude="*.spec.ts"; then
            echo "‚ùå Remove console.log from codebase before merging."
            exit 1
          else
            echo "‚úî No console.log found."
          fi

      # 6Ô∏è‚É£ SECURITY AUDIT
      - name: Run security audit
        run: npm audit --omit=dev || true

      # 7Ô∏è‚É£ BUILD CHECK
      - name: Build Project
        run: npm run build

      # 8Ô∏è‚É£ SUMMARY
      - name: CI Success Summary
        run: echo "üéâ All CI checks passed successfully!"
